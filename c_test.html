<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Student Performance Analysis Dashboard Engine</title>
    
    <!-- CSS -->
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
    <style>
        /* Your custom styles */
    </style>
</head>

<body>
    <div id="content" style="padding-left: 5%; padding-right: 5%; width: 100%;">
        <div id="example-table"></div>
        <button id="add-row-button">Add Row</button>
        <button id="edit-row-button">Edit Row</button>
        <button id="delete-row-button">Delete Row</button>

        <!-- Modal for adding/editing record -->
        <div id="recordModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2><span id="modalTitle">Add New Record</span></h2>
                <form id="recordForm">
                    <input type="hidden" id="editRowId">
                    <label for="name">Name:</label>
                    <input type="text" id="nameInput" name="name" required><br><br>
                    <label for="course">Course:</label>
                    <input type="text" id="courseInput" name="course" required><br><br>
                    <label for="assessmentType">Assessment Type:</label>
                    <select id="assessmentTypeInput" name="assessmentType">
                        <option value="quiz">Quiz</option>
                        <option value="assignment">Assignment</option>
                    </select><br><br>
                    <label for="grade">Grade:</label>
                    <input type="number" id="gradeInput" name="grade" min="0" max="100" required><br><br>
                    <button type="submit" id="submitRecordButton">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var tableData = JSON.parse(localStorage.getItem('tabulatorData')) || [];
            var table = new Tabulator("#example-table", {
                data: tableData,
                layout: "fitColumns",
                columns: [
                    { title: "Name", field: "name", editor: "input" },
                    { title: "Course", field: "course", editor: "input" },
                    { title: "Assessment Type", field: "assessmentType", editor: "input" },
                    { title: "Grade", field: "grade", editor: "input" }
                ]
            });

            function openModalForRecord(record) {
                document.getElementById('modalTitle').textContent = 'Edit Record';
                document.getElementById('editRowId').value = record.id;
                document.getElementById('nameInput').value = record.name;
                document.getElementById('courseInput').value = record.course;
                document.getElementById('assessmentTypeInput').value = record.assessmentType;
                document.getElementById('gradeInput').value = record.grade;
                document.getElementById('recordModal').style.display = "block";
            }

            document.getElementById('add-row-button').addEventListener('click', function () {
                document.getElementById('modalTitle').textContent = 'Add New Record';
                document.getElementById('editRowId').value = '';
                document.getElementById('recordForm').reset();
                document.getElementById('recordModal').style.display = "block";
            });

            document.getElementsByClassName('close')[0].addEventListener('click', function () {
                document.getElementById('recordModal').style.display = "none";
            });

            document.getElementById('recordForm').addEventListener('submit', function (event) {
                event.preventDefault();
                var formData = new FormData(this);
                var rowData = {};
                formData.forEach(function (value, key) {
                    rowData[key] = value;
                });
                rowData.id = document.getElementById('editRowId').value || table.getDataCount() + 1;

                if (rowData.id) {
                    // Update existing record
                    var existingRecord = table.getData().find(record => record.id == rowData.id);
                    if (existingRecord) {
                        table.updateRow(rowData.id, rowData);
                    }
                } else {
                    // Add new record
                    table.addRow(rowData, true, "top");
                }

                localStorage.setItem('tabulatorData', JSON.stringify(table.getData()));
                document.getElementById('recordForm').reset();
                document.getElementById('recordModal').style.display = "none";
            });

            document.getElementById('edit-row-button').addEventListener('click', function () {
                var selectedRows = table.getSelectedRows();
                if (selectedRows.length === 1) {
                    openModalForRecord(selectedRows[0].getData());
                } else {
                    alert('Please select a single row to edit.');
                }
            });

            document.getElementById('delete-row-button').addEventListener('click', function () {
                var selectedRows = table.getSelectedRows();
                if (selectedRows.length > 0) {
                    selectedRows.forEach(row => table.deleteRow(row));
                    localStorage.setItem('tabulatorData', JSON.stringify(table.getData()));
                } else {
                    alert('Please select row(s) to delete.');
                }
            });
        });
    </script>
</body>

</html>
